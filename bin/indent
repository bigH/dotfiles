#!/usr/bin/env bash

# this nicely indents both stderr and stdout
indent() {
  if [ -n "$1" ] && [ "$1" = "--header" ]; then
    shift
    printf "\$ $1"
    for arg in "$@"; do
      printf " '%s'" "$arg"
    done
    echo
  fi

  { "$@" 2>&3 | sed >&2 's/^/    /'; } 3>&1 1>&2 | sed 's/^/    /';
}

indent "$@"
