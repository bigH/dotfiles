#!/usr/bin/env bash

git_vim() {
  local files targets
  if [ $# -eq 0 ]; then
    files=$(git status --short --porcelain | cut -c4- | file-must-exist) || return
  else
    files=$(git diff --name-only "$@" | file-must-exist) || return
  fi
  targets=$(echo "$files" | fzf -m --preview="bat --style=numbers --color=always {}") || return
  echo "$targets" &&
  vim $targets
}

git_vim "$@"
